services:
  n8n:
    image: docker.n8n.io/n8nio/n8n:latest
    container_name: n8n
    restart: unless-stopped
    user: root

    environment:
      # Timezone used for workflow schedules and logs
      TZ: ${TZ}

      # SQLite database connection pool size
      DB_SQLITE_POOL_SIZE: ${DB_SQLITE_POOL_SIZE}

      # Enable workflow runners (improves performance)
      N8N_RUNNERS_ENABLED: ${N8N_RUNNERS_ENABLED}

      # Allow environment variable access inside nodes
      N8N_BLOCK_ENV_ACCESS_IN_NODE: ${N8N_BLOCK_ENV_ACCESS_IN_NODE}

      # Prevent git nodes from creating bare repos internally
      N8N_GIT_NODE_DISABLE_BARE_REPOS: ${N8N_GIT_NODE_DISABLE_BARE_REPOS}

      # Disable community nodes for tighter security
      N8N_COMMUNITY_NODES_ENABLED: ${N8N_COMMUNITY_NODES_ENABLED}

      # Disable diagnostics and telemetry
      N8N_DIAGNOSTICS_ENABLED: ${N8N_DIAGNOSTICS_ENABLED}
      N8N_TELEMETRY_ENABLED: ${N8N_TELEMETRY_ENABLED}

      # Default workflow HTTP timeout
      N8N_DEFAULT_TIMEOUT: ${N8N_DEFAULT_TIMEOUT}

      # Base hostname and URLs
      N8N_HOST: ${N8N_HOST}
      N8N_PROTOCOL: ${N8N_PROTOCOL}
      N8N_WEBHOOK_URL: ${N8N_WEBHOOK_URL}
      N8N_EDITOR_BASE_URL: ${N8N_EDITOR_BASE_URL}
      N8N_WEBHOOK_TUNNEL_URL: ${N8N_WEBHOOK_TUNNEL_URL}

      # API & proxy settings
      N8N_PUBLIC_API_DISABLED: ${N8N_PUBLIC_API_DISABLED}
      N8N_TRUST_PROXY: ${N8N_TRUST_PROXY}
      N8N_TRUSTED_PROXIES: ${N8N_TRUSTED_PROXIES}
      N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS: ${N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS}
      WEBHOOK_URL: ${WEBHOOK_URL}

      # User management
      N8N_USER_MANAGEMENT_DISABLED: ${N8N_USER_MANAGEMENT_DISABLED}
      N8N_BASIC_AUTH_ACTIVE: ${N8N_BASIC_AUTH_ACTIVE}
      N8N_SECURE_COOKIE: ${N8N_SECURE_COOKIE}

      # Optional SMTP config (uncomment and add in .env if needed)
      # N8N_SMTP_HOST: ${N8N_SMTP_HOST}
      # N8N_SMTP_PORT: ${N8N_SMTP_PORT}
      # N8N_SMTP_USER: ${N8N_SMTP_USER}
      # N8N_SMTP_PASS: ${N8N_SMTP_PASS}
      # N8N_SMTP_SENDER: ${N8N_SMTP_SENDER}

    volumes:
      - data:/root/.n8n

    ports:
      - "5678:5678"

volumes:
  data:
    driver: local
